import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";

const firebaseConfig = {
  apiKey: "AIzaSyAAlNNWN6zmeytGfHwVKC34Vei0g2UDpD8",
  authDomain: "gaby5555.firebaseapp.com",
  projectId: "gaby5555",
  storageBucket: "gaby5555.firebasestorage.app",
  messagingSenderId: "60126292567",
  appId: "1:60126292567:web:309dc641ce5c26bb8b5112",
  measurementId: "G-XLXSHCYYK2"
};

const app = initializeApp(firebaseConfig);

import { getDatabase, ref, child, get, set, update, remove } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

const db = getDatabase();

// CAMPOS DE ENTRADAS
let codigo = document.getElementById('codigo');
let vinil = document.getElementById('vinil');
let artista = document.getElementById('artista');
let quantidade = document.getElementById('quantidade');
let valor = document.getElementById('valor');

// CAMPOS DE PESQUISA
let idProduto = document.getElementById('idProduto');

// RESULTADOS DA PESQUISA
let dadoVinil = document.getElementById('dadoVinil');
let dadoArtista = document.getElementById('dadoArtista');
let dadoQuantidade = document.getElementById('dadoQuantidade');
let dadoValor = document.getElementById('dadoValor');

// BOTÕES
let cadastrarProduto = document.getElementById('cadastrarProduto');
let buscarProduto = document.getElementById('buscarProduto');
let atualizarProduto = document.getElementById('atualizarProduto');
let deletarProduto = document.getElementById('deletarProduto');

// ADICIONAR VINIL
function AddProduto() {
  set(ref(db, 'Produto/' + codigo.value), {
    codigo: codigo.value,
    vinil: vinil.value,
    artista: artista.value,
    quantidade: quantidade.value,
    valor: valor.value
  }).then(() => {
    codigo.value = '';
    vinil.value = '';
    artista.value = '';
    quantidade.value = '';
    valor.value = '';
    alert("Vinil cadastrado!");
  }).catch((error) => {
    console.log(error);
    alert('Erro ao cadastrar vinil!');
  });
}

// PESQUISAR VINIL
function PesquisarProduto() {
  const dbRef = ref(db);
  get(child(dbRef, 'Produto/' + idProduto.value)).then((snapshot) => {
    if (snapshot.exists()) {
      dadoVinil.value = snapshot.val().vinil;
      dadoArtista.value = snapshot.val().artista;
      dadoQuantidade.value = snapshot.val().quantidade;
      dadoValor.value = 'R$ ' + parseFloat(snapshot.val().valor).toFixed(2);
      alert('Vinil localizado!');
    } else {
      alert("O vinil não existe");
    }
  }).catch((e) => {
    alert('Erro ao pesquisar!');
    console.log(e);
  });
}

// ATUALIZAR VINIL
function AtualizarProdutos() {
  update(ref(db, 'Produto/' + idProduto.value), {
    vinil: dadoVinil.value,
    artista: dadoArtista.value,
    quantidade: dadoQuantidade.value,
    valor: dadoValor.value
  }).then(() => {
    alert('Vinil atualizado!');
  }).catch((e) => {
    alert('Erro ao atualizar!');
    console.log(e);
  });
}

// DELETAR VINIL
function DeletarProdutos() {
  remove(ref(db, 'Produto/' + idProduto.value)).then(() => {
    idProduto.value = '';
    dadoVinil.value = '';
    dadoArtista.value = '';
    dadoQuantidade.value = '';
    dadoValor.value = '';
    alert('Vinil deletado!');
  });
}

// EVENTOS DOS BOTÕES
cadastrarProduto.addEventListener('click', AddProduto);
buscarProduto.addEventListener('click', PesquisarProduto);
atualizarProduto.addEventListener('click', AtualizarProdutos);
deletarProduto.addEventListener('click', DeletarProdutos);
